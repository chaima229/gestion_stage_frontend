<div class="p-4 sm:p-6">
  <!-- Page Subtitle -->
  <div class="mb-4">
    <p class="text-gray-500 text-xs sm:text-sm">{{ filieres.length }} filière(s)</p>
  </div>

  <!-- Page Header -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
    <h1 class="text-xl sm:text-2xl font-bold text-gray-800">Filières</h1>
    <div class="flex flex-wrap gap-3">
      <button
        class="inline-flex items-center gap-2 px-4 py-2.5 bg-gray-600 text-white text-sm font-medium rounded-xl hover:bg-gray-700 transition-colors"
        (click)="openImportModal()"
      >
        <app-icon name="fileText" [size]="18"></app-icon>
        Importer Excel
      </button>
      <button
        class="inline-flex items-center gap-2 px-4 py-2.5 bg-blue-600 text-white text-sm font-medium rounded-xl hover:bg-blue-700 transition-colors"
        (click)="openForm()"
      >
        <app-icon name="plus" [size]="18"></app-icon>
        Ajouter une filière
      </button>
    </div>
  </div>

  <!-- Error Alert -->
  <div *ngIf="error" class="alert alert-danger mb-6">
    <p class="flex-1">{{ error }}</p>
    <button class="text-red-600 hover:text-red-800 transition-colors" (click)="error = null">
      <app-icon name="x" [size]="18"></app-icon>
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex flex-col items-center justify-center py-20">
    <div class="spinner"></div>
    <p class="mt-4 text-gray-500 text-sm">Chargement des filières...</p>
  </div>

  <!-- Filieres Grid -->
  <div
    *ngIf="!isLoading && filieres.length > 0"
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6"
  >
    <div
      *ngFor="let filiere of paginatedFilieres"
      class="card hover:shadow-lg transition-all duration-300 cursor-pointer"
    >
      <!-- Card Header -->
      <div class="p-4 sm:p-6 border-b border-gray-100 flex items-start justify-between">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
            <app-icon name="bookOpen" [size]="24" class="text-blue-600"></app-icon>
          </div>
          <div>
            <h3 class="font-semibold text-gray-800 text-base">{{ filiere.nom }}</h3>
            <span
              class="inline-block mt-1 px-2 py-1 rounded-full text-xs font-medium"
              [ngClass]="getFiliereBadgeColor(filiere.niveau)"
            >
              {{ filiere.niveau }}
            </span>
          </div>
        </div>
        <button
          class="text-gray-400 hover:text-gray-600 transition-colors"
          (click)="openForm(filiere); $event.stopPropagation()"
        >
          <app-icon name="fileEdit" [size]="20"></app-icon>
        </button>
      </div>

      <!-- Card Body -->
      <div class="p-4 sm:p-6">
        <p class="text-gray-600 text-sm mb-4 line-clamp-2">
          {{ filiere.description || 'Aucune description disponible' }}
        </p>

        <!-- Stats -->
        <div class="flex items-center gap-4 text-sm text-gray-500">
          <div class="flex items-center gap-2">
            <app-icon name="users" [size]="16"></app-icon>
            <span>{{ filiere.etudiantsCount ?? 0 }} étudiant(s)</span>
          </div>
          <div class="flex items-center gap-2">
            <app-icon name="briefcase" [size]="16"></app-icon>
            <span>{{ filiere.stagesCount ?? 0 }} stage(s)</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination Controls -->
  <div
    *ngIf="!isLoading && filieres.length > 0"
    class="flex items-center justify-between mt-6 px-2"
  >
    <div class="text-sm text-gray-600">
      Affichage de {{ (currentPage - 1) * itemsPerPage + 1 }} à
      {{ Math.min(currentPage * itemsPerPage, filieres.length) }} sur {{ filieres.length }} filières
    </div>
    <div class="flex items-center gap-2">
      <button
        class="px-3 py-2 rounded-lg text-sm font-medium transition-colors"
        [class.bg-gray-100]="currentPage > 1"
        [class.text-gray-700]="currentPage > 1"
        [class.hover:bg-gray-200]="currentPage > 1"
        [class.bg-gray-50]="currentPage === 1"
        [class.text-gray-400]="currentPage === 1"
        [class.cursor-not-allowed]="currentPage === 1"
        [disabled]="currentPage === 1"
        (click)="previousPage()"
      >
        Précédent
      </button>
      <div class="flex items-center gap-1">
        <button
          *ngFor="let page of pages"
          class="w-10 h-10 rounded-lg text-sm font-medium transition-colors"
          [class.bg-blue-600]="page === currentPage"
          [class.text-white]="page === currentPage"
          [class.bg-gray-100]="page !== currentPage"
          [class.text-gray-700]="page !== currentPage"
          [class.hover:bg-gray-200]="page !== currentPage"
          (click)="goToPage(page)"
        >
          {{ page }}
        </button>
      </div>
      <button
        class="px-3 py-2 rounded-lg text-sm font-medium transition-colors"
        [class.bg-gray-100]="currentPage < totalPages"
        [class.text-gray-700]="currentPage < totalPages"
        [class.hover:bg-gray-200]="currentPage < totalPages"
        [class.bg-gray-50]="currentPage === totalPages"
        [class.text-gray-400]="currentPage === totalPages"
        [class.cursor-not-allowed]="currentPage === totalPages"
        [disabled]="currentPage === totalPages"
        (click)="nextPage()"
      >
        Suivant
      </button>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && filieres.length === 0" class="card p-12 text-center">
    <div class="w-16 h-16 mx-auto bg-gray-100 rounded-full flex items-center justify-center mb-4">
      <app-icon name="bookOpen" [size]="32" class="text-gray-400"></app-icon>
    </div>
    <h3 class="text-xl font-semibold text-gray-800 mb-2">Aucune filière créée</h3>
    <p class="text-gray-500 mb-6">Commencez par créer une nouvelle filière.</p>
    <button
      class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 transition-colors"
      (click)="openForm()"
    >
      <app-icon name="plus" [size]="18"></app-icon>
      Créer une filière
    </button>
  </div>

  <!-- Form Modal -->
  <div *ngIf="showForm" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
    <div class="card w-full max-w-lg animate-slide-up max-h-[90vh] overflow-y-auto">
      <div class="p-6 border-b border-gray-100 flex items-center justify-between">
        <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
          <app-icon
            [name]="editingId ? 'fileEdit' : 'plus'"
            [size]="20"
            class="text-blue-600"
          ></app-icon>
          {{ editingId ? 'Modifier une filière' : 'Créer une nouvelle filière' }}
        </h2>
        <button
          class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 transition-colors"
          (click)="closeForm()"
        >
          <app-icon name="x" [size]="20"></app-icon>
        </button>
      </div>
      <div class="p-6 space-y-4">
        <div class="space-y-2">
          <label for="nom" class="block text-sm font-medium text-gray-700">Nom de la Filière</label>
          <input
            type="text"
            class="input"
            id="nom"
            [(ngModel)]="formData.nom"
            placeholder="ex: Génie Informatique"
          />
        </div>
        <div class="space-y-2">
          <label for="niveau" class="block text-sm font-medium text-gray-700">Niveau</label>
          <select class="input" id="niveau" [(ngModel)]="formData.niveau">
            <option value="B1">B1</option>
            <option value="B2">B2</option>
            <option value="B3">B3</option>
            <option value="M1">M1</option>
            <option value="M2">M2</option>
          </select>
        </div>
        <div class="space-y-2">
          <label for="description" class="block text-sm font-medium text-gray-700"
            >Description</label
          >
          <textarea
            class="input min-h-[100px] resize-none"
            id="description"
            rows="3"
            [(ngModel)]="formData.description"
            placeholder="Description de la filière"
          ></textarea>
        </div>
      </div>
      <div class="p-6 border-t border-gray-100 flex justify-end gap-3 sticky bottom-0 bg-white">
        <button class="btn btn-ghost" (click)="closeForm()">Annuler</button>
        <button class="btn btn-primary" (click)="saveFiler()">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Import Modal -->
  <div
    *ngIf="showImportModal"
    class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  >
    <div class="card w-full max-w-2xl animate-slide-up max-h-[90vh] overflow-y-auto">
      <div class="p-6 border-b border-gray-100 flex items-center justify-between">
        <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
          <app-icon name="fileText" [size]="20" class="text-blue-600"></app-icon>
          Importer des filières depuis Excel
        </h2>
        <button
          class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 transition-colors"
          (click)="closeImportModal()"
        >
          <app-icon name="x" [size]="20"></app-icon>
        </button>
      </div>
      <div class="p-6 space-y-6">
        <!-- Instructions -->
        <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
          <h4 class="font-semibold text-blue-800 mb-2 flex items-center gap-2">
            <app-icon name="inbox" [size]="18"></app-icon>
            Format du fichier Excel attendu :
          </h4>
          <p class="text-blue-700 text-sm mb-3">
            Le fichier doit contenir les colonnes suivantes (dans cet ordre) :
          </p>
          <ol class="list-decimal list-inside text-sm text-blue-700 space-y-1">
            <li><strong>Nom</strong> - Nom de la filière</li>
            <li><strong>Niveau</strong> - M1 ou M2</li>
            <li><strong>Description</strong> - Description de la filière (optionnel)</li>
          </ol>
        </div>

        <!-- File Input -->
        <div class="space-y-2">
          <label for="fileInput" class="block text-sm font-medium text-gray-700">
            Sélectionner un fichier Excel (.xlsx ou .xls)
          </label>
          <input
            type="file"
            id="fileInput"
            #fileInput
            class="input"
            accept=".xlsx,.xls"
            (change)="onFileSelected($event)"
          />
        </div>

        <!-- Loading -->
        <div *ngIf="importLoading" class="flex flex-col items-center justify-center py-8">
          <div class="spinner"></div>
          <p class="mt-4 text-gray-500">Import en cours...</p>
        </div>
      </div>
      <div class="p-6 border-t border-gray-100 flex justify-end">
        <button class="btn btn-secondary" (click)="closeImportModal()">Fermer</button>
      </div>
    </div>
  </div>
</div>
